"use strict";(()=>{var e={};e.id=262,e.ids=[262],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7464:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>h,requestAsyncStorage:()=>k,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>w});var a={};r.r(a),r.d(a,{GET:()=>GET,POST:()=>POST}),r(78976);var s=r(10884),o=r(16132),n=r(95798),i=r(7542),u=r(63340),l=r(99964);async function POST(e){try{let t=await e.json(),{streakId:r,date:a,status:s}=t,o=(0,u.Z)((0,l.Z)(a));if(!["FOLLOWED","BROKEN","SKIP"].includes(s))return n.Z.json({error:"Invalid status"},{status:400});let d=await i._.streakLog.upsert({where:{streakId_date:{streakId:r,date:o}},update:{status:s},create:{streakId:r,date:o,status:s}}),k=await i._.streak.findUnique({where:{id:r}});if(!k)throw Error("Streak not found");let c=k.currentStreak,p=k.highestStreak,g=k.lastBrokenDate;if(k.startDate,"BROKEN"===s)c=0,(!k.lastBrokenDate||o>k.lastBrokenDate)&&(g=o);else if("FOLLOWED"===s){let e=k.lastBrokenDate,t=await i._.streakLog.count({where:{streakId:r,status:"FOLLOWED",date:{gt:e||new Date("1970-01-01")}}});(c=t)>p&&(p=c)}else if("SKIP"===s){let e=k.lastBrokenDate,t=await i._.streakLog.count({where:{streakId:r,status:"FOLLOWED",date:{gt:e||new Date("1970-01-01")}}});c=t}let w=await i._.streak.update({where:{id:r},data:{currentStreak:c,highestStreak:p,lastBrokenDate:g}});return n.Z.json({log:d,streak:w})}catch(e){return console.error(e),n.Z.json({error:"Failed to log streak"},{status:500})}}async function GET(e){let{searchParams:t}=new URL(e.url),r=t.get("date"),a=t.get("streakId");try{if(r){let e=(0,u.Z)((0,l.Z)(r)),t=await i._.streakLog.findMany({where:{date:e}});return n.Z.json(t)}if(a){let e=await i._.streakLog.findMany({where:{streakId:a},orderBy:{date:"asc"}});return n.Z.json(e)}return n.Z.json([])}catch(e){return n.Z.json({error:"Failed to fetch logs"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/streaks/log/route",pathname:"/api/streaks/log",filename:"route",bundlePath:"app/api/streaks/log/route"},resolvedPagePath:"/Users/varun/Desktop/Habit Tracker/src/app/api/streaks/log/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:k,staticGenerationAsyncStorage:c,serverHooks:p,headerHooks:g,staticGenerationBailout:w}=d,h="/api/streaks/log/route"},7542:(e,t,r)=>{r.d(t,{_:()=>o});let a=require("@prisma/client"),s=globalThis,o=s.prisma??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[955,444],()=>__webpack_exec__(7464));module.exports=r})();